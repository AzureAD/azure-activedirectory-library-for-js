// @preserve Copyright (c) Microsoft Open Technologies, Inc.
"use strict";var Logging={level:0,log:function(){}},AuthenticationContext;"undefined"!=typeof module&&module.exports&&(module.exports.inject=function(t){return new AuthenticationContext(t)}),AuthenticationContext=function(t){if(this.REQUEST_TYPE={LOGIN:"LOGIN",RENEW_TOKEN:"RENEW_TOKEN",UNKNOWN:"UNKNOWN"},this.CONSTANTS={ACCESS_TOKEN:"access_token",EXPIRES_IN:"expires_in",ID_TOKEN:"id_token",ERROR_DESCRIPTION:"error_description",SESSION_STATE:"session_state",STORAGE:{TOKEN_KEYS:"adal.token.keys",ACCESS_TOKEN_KEY:"adal.access.token.key",EXPIRATION_KEY:"adal.expiration.key",START_PAGE:"adal.start.page",START_PAGE_PARAMS:"adal.start.page.params",STATE_LOGIN:"adal.state.login",STATE_RENEW:"adal.state.renew",STATE_RENEW_RESOURCE:"adal.state.renew.resource",NONCE_IDTOKEN:"adal.nonce.idtoken",SESSION_STATE:"adal.session.state",USERNAME:"adal.username",IDTOKEN:"adal.idtoken",ERROR:"adal.error",ERROR_DESCRIPTION:"adal.error.description",LOGIN_REQUEST:"adal.login.request",LOGIN_ERROR:"adal.login.error"},RESOURCE_DELIMETER:"|",ERR_MESSAGES:{NO_TOKEN:"User is not authorized"},LOGGING_LEVEL:{ERROR:0,WARN:1,INFO:2,VERBOSE:3},LEVEL_STRING_MAP:{0:"ERROR:",1:"WARNING:",2:"INFO:",3:"VERBOSE:"}},AuthenticationContext.prototype._singletonInstance)return AuthenticationContext.prototype._singletonInstance;if(AuthenticationContext.prototype._singletonInstance=this,this.instance="https://login.microsoftonline.com/",this.config={},this.callback=null,this.popUp=!1,this._user=null,self._clearRenewState(),t.displayCall&&"function"!=typeof t.displayCall)throw Error("displayCall is not a function");if(!t.clientId)throw Error("clientId is required");t.correlationId||(t.correlationId=this._guid()),this.config=this._cloneConfig(t),this.config.loginResource||(this.config.loginResource=this.config.clientId),this.config.redirectUri||(this.config.redirectUri=window.location.href)},AuthenticationContext.prototype.login=function(){var t=this._guid();this.config.state=t,this._idTokenNonce=this._guid(),this.verbose("Expected state: "+t+" startPage:"+window.location),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,window.location),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,t),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var e=this._getNavigateUrl("id_token",null)+"&nonce="+encodeURIComponent(this._idTokenNonce);this.frameCallInProgress=!1,this._loginInProgress=!0,this.config.displayCall?this.config.displayCall(e):this.promptUser(e)},AuthenticationContext.prototype.loginInProgress=function(){return this._loginInProgress},AuthenticationContext.prototype._hasResource=function(t){var e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);return e&&!this._isEmpty(e)&&e.indexOf(t+this.CONSTANTS.RESOURCE_DELIMETER)>-1},AuthenticationContext.prototype.getCachedToken=function(t){if(!this._hasResource(t))return null;var e=this._getItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t),n=this._getItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t),i=this.config.expireOffsetSeconds||120;return n&&n>this._now()+i?e:(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t,0),null)},AuthenticationContext.prototype.getCachedUser=function(){if(this._user)return this._user;var t=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);return this._user=this._createUser(t),this._user},AuthenticationContext.prototype.registerCallback=function(t,e,n){this._activeRenewals[e]=t,window.callBacksMappedToRenewStates[t]||(window.callBacksMappedToRenewStates[t]=[]);var i=this;window.callBacksMappedToRenewStates[t].push(n),window.callBackMappedToRenewStates[t]||(window.callBackMappedToRenewStates[t]=function(n,o){for(var r=0;r<window.callBacksMappedToRenewStates[t].length;++r)window.callBacksMappedToRenewStates[t][r](n,o);i._activeRenewals[e]=null,window.callBacksMappedToRenewStates[t]=null,window.callBackMappedToRenewStates[t]=null})},AuthenticationContext.prototype._renewToken=function(t,e){this.info("renewToken is called for resource:"+t);var n=this._addAdalFrame("adalRenewFrame"+t),i=this._guid()+"|"+t;this._idTokenNonce=this._guid(),this.config.state=i,this._renewStates.push(i),this.verbose("Renew token Expected state: "+i);var o=this._getNavigateUrl("token",t)+"&prompt=none&login_hint="+encodeURIComponent(this._user.userName);this._urlContainsQueryStringParameter("domain_hint",o)||(o+="&domain_hint="+encodeURIComponent(this._getDomainHint())),o+="&nonce="+encodeURIComponent(this._idTokenNonce),this.callback=e,this.registerCallback(i,t,e),this.idTokenNonce=null,this.verbose("Navigate to:"+o),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,""),n.src="about:blank",this._loadFrame(o,"adalRenewFrame"+t)},AuthenticationContext.prototype._renewIdToken=function(t){this.info("renewIdToken is called");var e=this._addAdalFrame("adalIdTokenFrame"),n=this._guid()+"|"+this.config.clientId;this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce),this.config.state=n,this._renewStates.push(n),this.verbose("Renew Idtoken Expected state: "+n);var i=this._getNavigateUrl("id_token",null)+"&prompt=none&login_hint="+encodeURIComponent(this._user.userName);this._urlContainsQueryStringParameter("domain_hint",i)||(i+="&domain_hint="+encodeURIComponent(this._getDomainHint())),i+="&nonce="+encodeURIComponent(this._idTokenNonce),this.registerCallback(n,this.config.clientId,t),this.idTokenNonce=null,this.verbose("Navigate to:"+i),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,""),e.src="about:blank",this._loadFrame(i,"adalIdTokenFrame")},AuthenticationContext.prototype._clearRenewState=function(){this._activeRenewals={},this._loginInProgress=!1,this._renewStates=[],window.callBackMappedToRenewStates={},window.callBacksMappedToRenewStates={}},AuthenticationContext.prototype._cancelOutstandingRequests=function(){self._removeAdalFrame("adalIdTokenFrame");for(var t in this._activeRenewals)if(this._activeRenewals.hasOwnProperty(t)){var e="adalRenewFrame"+this._activeRenewals[t];self._removeAdalFrame(e)}self._clearRenewState()},AuthenticationContext.prototype._urlContainsQueryStringParameter=function(t,e){var n=RegExp("[\\?&]"+t+"=");return n.test(e)},AuthenticationContext.prototype._loadFrame=function(t,e){var n=this;n.info("LoadFrame: "+e);var i=e;setTimeout(function(){var e=n._addAdalFrame(i);(""===e.src||"about:blank"===e.src)&&(e.src=t,n._loadFrame(t,i))},500)},AuthenticationContext.prototype.acquireToken=function(t,e){if(this._isEmpty(t))return this.warn("resource is required"),void e("resource is required",null);var n=this.getCachedToken(t);return n?(this.info("Token is already in cache for resource:"+t),void e(null,n)):this._user?void(this._activeRenewals[t]?this.registerCallback(this._activeRenewals[t],t,e):t===this.config.clientId?(this.verbose("renewing idtoken"),this._renewIdToken(e)):this._renewToken(t,e)):(this.warn("User login is required"),void e("User login is required",null))},AuthenticationContext.prototype.promptUser=function(t){t?(this.info("Navigate to:"+t),window.location.replace(t)):this.info("Navigate url is empty")},AuthenticationContext.prototype.clearCache=function(){this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY,0),this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._renewStates=[],this._saveItem(this.CONSTANTS.STORAGE.START_PAGE,""),this._saveItem(this.CONSTANTS.STORAGE.START_PAGE_PARAMS,""),this._saveItem(this.CONSTANTS.STORAGE.USERNAME,""),this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);if(!this._isEmpty(t)){t=t.split(this.CONSTANTS.RESOURCE_DELIMETER);for(var e=0;e<t.length;e++)this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t[e],""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t[e],0)}this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,"")},AuthenticationContext.prototype.clearCacheForResource=function(t){this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._hasResource(t)&&(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t,0))},AuthenticationContext.prototype.logOut=function(){this.clearCache();var t="common",e="";this._user=null,this.config.tenant&&(t=this.config.tenant),this.config.instance&&(this.instance=this.config.instance),this.config.postLogoutRedirectUri&&(e="post_logout_redirect_uri="+encodeURIComponent(this.config.postLogoutRedirectUri));var n=this.instance+t+"/oauth2/logout?"+e;this.info("Logout navigate to: "+n),this.promptUser(n)},AuthenticationContext.prototype._isEmpty=function(t){return void 0===t||!t||0===t.length},AuthenticationContext.prototype.getUser=function(t){if("function"!=typeof t)throw Error("callback is not a function");if(this.callback=t,this._user)return void this.callback(null,this._user);var e=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);this._isEmpty(e)?(this.warn("User information is not available"),this.callback("User information is not available")):(this.info("User exists in cache: "),this._user=this._createUser(e),this.callback(null,this._user))},AuthenticationContext.prototype._getDomainHint=function(){if(this._user&&this._user.userName&&this._user.userName.indexOf("@")>-1){var t=this._user.userName.split("@");return t[t.length-1]}return""},AuthenticationContext.prototype._createUser=function(t){var e=null,n=this._extractIdToken(t);return n&&n.hasOwnProperty("aud")&&(n.aud.toLowerCase()===this.config.clientId.toLowerCase()?(e={userName:"",profile:n},n.hasOwnProperty("upn")?e.userName=n.upn:n.hasOwnProperty("email")&&(e.userName=n.email)):this.warn("IdToken has invalid aud field")),e},AuthenticationContext.prototype._getHash=function(t){return t.indexOf("#/")>-1?t=t.substring(t.indexOf("#/")+2):t.indexOf("#")>-1&&(t=t.substring(1)),t},AuthenticationContext.prototype.isCallback=function(t){t=this._getHash(t);var e=this._deserialize(t);return e.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||e.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||e.hasOwnProperty(this.CONSTANTS.ID_TOKEN)},AuthenticationContext.prototype.getLoginError=function(){return this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR)},AuthenticationContext.prototype.getRequestInfo=function(t){t=this._getHash(t);var e=this._deserialize(t),n={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:this.REQUEST_TYPE.UNKNOWN};if(e&&(n.parameters=e,e.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||e.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||e.hasOwnProperty(this.CONSTANTS.ID_TOKEN))){n.valid=!0;var i="";if(!e.hasOwnProperty("state"))return this.warn("No state returned"),n;if(this.verbose("State: "+e.state),i=e.state,n.stateResponse=i,i===this._getItem(this.CONSTANTS.STORAGE.STATE_LOGIN))return n.requestType=this.REQUEST_TYPE.LOGIN,n.stateMatch=!0,n;if(!n.stateMatch&&window.parent&&window.parent.AuthenticationContext())for(var o=window.parent.AuthenticationContext()._renewStates,r=0;r<o.length;r++)if(o[r]===n.stateResponse){n.requestType=this.REQUEST_TYPE.RENEW_TOKEN,n.stateMatch=!0;break}}return n},AuthenticationContext.prototype._getResourceFromState=function(t){if(t){var e=t.indexOf("|");if(e>-1&&e+1<t.length)return t.substring(e+1)}return""},AuthenticationContext.prototype.saveTokenFromHash=function(t){if(this.info("State status:"+t.stateMatch+"; Request type:"+t.requestType),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),t.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION))this.info("Error :"+t.parameters.error+"; Error description:"+t.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),this._saveItem(this.CONSTANTS.STORAGE.ERROR,t.parameters.error),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,t.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),t.requestType===this.REQUEST_TYPE.LOGIN&&(this._loginInProgress=!1,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,t.parameters.errorDescription));else if(t.stateMatch){this.info("State is right"),t.parameters.hasOwnProperty(this.CONSTANTS.SESSION_STATE)&&this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,t.parameters[this.CONSTANTS.SESSION_STATE]);var e,n;t.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)&&(this.info("Fragment has access token"),n=this._getResourceFromState(t.stateResponse),this._hasResource(n)||(e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,e+n+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+n,t.parameters[this.CONSTANTS.ACCESS_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+n,this._expiresIn(t.parameters[this.CONSTANTS.EXPIRES_IN]))),t.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)&&(this.info("Fragment has id token"),this._loginInProgress=!1,this._user=this._createUser(t.parameters[this.CONSTANTS.ID_TOKEN]),this._user&&this._user.profile&&(this._user.profile.nonce!==this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN)?(this._user=null,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Nonce is not same as "+this._idTokenNonce)):(this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,t.parameters[this.CONSTANTS.ID_TOKEN]),n=this.config.loginResource?this.config.loginResource:this.config.clientId,this._hasResource(n)||(e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,e+n+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+n,t.parameters[this.CONSTANTS.ID_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+n,this._user.profile.exp))))}else this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Invalid_state"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid_state. state: "+t.stateResponse)},AuthenticationContext.prototype.getResourceForEndpoint=function(t){if(this.config&&this.config.endpoints)for(var e in this.config.endpoints)if(t.indexOf(e)>-1)return this.config.endpoints[e];return t.indexOf("http://")>-1||t.indexOf("https://")>-1?this._getHostFromUri(t)===this._getHostFromUri(this.config.redirectUri)?this.config.loginResource:null:this.config.loginResource},AuthenticationContext.prototype._getHostFromUri=function(t){var e=(t+"").replace(/^(https?:)\/\//,"");return e=e.split("/")[0]},AuthenticationContext.prototype.handleWindowCallback=function(){var t=window.location.hash;if(this.isCallback(t)){var e=this.getRequestInfo(t);this.info("Returned from redirect url"),this.saveTokenFromHash(e);var n=null;if(e.requestType===this.REQUEST_TYPE.RENEW_TOKEN&&window.parent?(this.verbose("Window is in iframe"),n=window.parent.callBackMappedToRenewStates[e.stateResponse],window.src=""):window&&window.oauth2Callback&&(this.verbose("Window is redirecting"),n=this.callback),window.location.hash="",window.location=this._getItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST),e.requestType===this.REQUEST_TYPE.RENEW_TOKEN)return void n(this._getItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION),e.parameters[this.CONSTANTS.ACCESS_TOKEN]||e.parameters[this.CONSTANTS.ID_TOKEN])}},AuthenticationContext.prototype._getNavigateUrl=function(t,e){var n="common";this.config.tenant&&(n=this.config.tenant),this.config.instance&&(this.instance=this.config.instance);var i=this.instance+n+"/oauth2/authorize"+this._serialize(t,this.config,e)+this._addLibMetadata();return this.info("Navigate url:"+i),i},AuthenticationContext.prototype._extractIdToken=function(t){var e=this._decodeJwt(t);if(!e)return null;try{var n=e.JWSPayload,i=this._base64DecodeStringUrlSafe(n);return i?JSON.parse(i):(this.info("The returned id_token could not be base64 url safe decoded."),null)}catch(o){this.error("The returned id_token could not be decoded",o)}return null},AuthenticationContext.prototype._extractUserName=function(t){try{var e=this._extractIdToken(t);if(e){if(e.hasOwnProperty("upn"))return e.upn;if(e.hasOwnProperty("email"))return e.email}}catch(n){this.error("The returned id_token could not be decoded",n)}return null},AuthenticationContext.prototype._base64DecodeStringUrlSafe=function(t){return t=t.replace(/-/g,"+").replace(/_/g,"/"),decodeURIComponent(window.atob?escape(window.atob(t)):escape(this._decode(t)))},AuthenticationContext.prototype._decode=function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t=(t+"").replace(/=+$/,"");var n=t.length;if(n%4===1)throw Error("The token to be decoded is not correctly encoded.");for(var i,o,r,s,a,c,h,u,l="",T=0;n>T;T+=4){if(i=e.indexOf(t.charAt(T)),o=e.indexOf(t.charAt(T+1)),r=e.indexOf(t.charAt(T+2)),s=e.indexOf(t.charAt(T+3)),T+2===n-1){a=i<<18|o<<12|r<<6,c=a>>16&255,h=a>>8&255,l+=String.fromCharCode(c,h);break}if(T+1===n-1){a=i<<18|o<<12,c=a>>16&255,l+=String.fromCharCode(c);break}a=i<<18|o<<12|r<<6|s,c=a>>16&255,h=a>>8&255,u=255&a,l+=String.fromCharCode(c,h,u)}return l},AuthenticationContext.prototype._decodeJwt=function(t){if(this._isEmpty(t))return null;var e=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/,n=e.exec(t);if(!n||n.length<4)return this.warn("The returned id_token is not parseable."),null;var i={header:n[1],JWSPayload:n[2],JWSSig:n[3]};return i},AuthenticationContext.prototype._convertUrlSafeToRegularBase64EncodedString=function(t){return t.replace("-","+").replace("_","/")},AuthenticationContext.prototype._serialize=function(t,e,n){var i=[];return null!==e&&(i.push("?response_type="+t),i.push("client_id="+encodeURIComponent(e.clientId)),n&&i.push("resource="+encodeURIComponent(n)),i.push("redirect_uri="+encodeURIComponent(e.redirectUri)),i.push("state="+encodeURIComponent(e.state)),e.hasOwnProperty("slice")&&i.push("slice="+encodeURIComponent(e.slice)),e.hasOwnProperty("extraQueryParameter")&&i.push(e.extraQueryParameter),e.correlationId&&i.push("client-request-id="+encodeURIComponent(e.correlationId))),i.join("&")},AuthenticationContext.prototype._deserialize=function(t){var e,n=/\+/g,i=/([^&=]+)=?([^&]*)/g,o=function(t){return decodeURIComponent(t.replace(n," "))},r={};for(e=i.exec(t);e;)r[o(e[1])]=o(e[2]),e=i.exec(t);return r},AuthenticationContext.prototype._guid=function(){for(var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",e="0123456789abcdef",n=0,i="",o=0;36>o;o++)"-"!==t[o]&&"4"!==t[o]&&(n=16*Math.random()|0),"x"===t[o]?i+=e[n]:"y"===t[o]?(n&=3,n|=8,i+=e[n]):i+=t[o];return i},AuthenticationContext.prototype._expiresIn=function(t){return this._now()+parseInt(t,10)},AuthenticationContext.prototype._now=function(){return Math.round((new Date).getTime()/1e3)},AuthenticationContext.prototype._removeAdalFrame=function(t){if(void 0!==t){this.info("Remove adal frame from document:"+t);var e=document.getElementById(t);e&&document.removeChild&&document.documentElement&&(window.opera||-1===window.navigator.userAgent.indexOf("MSIE 5.0"))&&document.getElementsByTagName("body")[0].removeChild(e)}},AuthenticationContext.prototype._addAdalFrame=function(t){if(void 0!==t){this.info("Add adal frame to document:"+t);var e=document.getElementById(t);if(!e){if(document.createElement&&document.documentElement&&(window.opera||-1===window.navigator.userAgent.indexOf("MSIE 5.0"))){var n=document.createElement("iframe");n.setAttribute("id",t),n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height=n.borderWidth="0px",e=document.getElementsByTagName("body")[0].appendChild(n)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+t+'" id="'+t+'" style="display:none"></iframe>');window.frames&&window.frames[t]&&(e=window.frames[t])}return e}},AuthenticationContext.prototype._saveItem=function(t,e){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?(localStorage.setItem(t,e),!0):(this.info("Local storage is not supported"),!1):this._supportsSessionStorage()?(sessionStorage.setItem(t,e),!0):(this.info("Session storage is not supported"),!1)},AuthenticationContext.prototype._getItem=function(t){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?localStorage.getItem(t):(this.info("Local storage is not supported"),null):this._supportsSessionStorage()?sessionStorage.getItem(t):(this.info("Session storage is not supported"),null)},AuthenticationContext.prototype._supportsLocalStorage=function(){try{return"localStorage"in window&&window.localStorage}catch(t){return!1}},AuthenticationContext.prototype._supportsSessionStorage=function(){try{return"sessionStorage"in window&&window.sessionStorage}catch(t){return!1}},AuthenticationContext.prototype._cloneConfig=function(t){if(null===t||"object"!=typeof t)return t;var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},AuthenticationContext.prototype._addLibMetadata=function(){return"&x-client-SKU=Js&x-client-Ver="+this._libVersion()},AuthenticationContext.prototype.log=function(t,e,n){if(t<=Logging.level){var i=this.config.correlationId,o=(new Date).toUTCString(),r=o+":"+i+"-"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[t]+" "+e;n&&(r+="\nstack:\n"+n.stack),Logging.log(r)}},AuthenticationContext.prototype.error=function(t,e){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,t,e)},AuthenticationContext.prototype.warn=function(t){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,t,null)},AuthenticationContext.prototype.info=function(t){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,t,null)},AuthenticationContext.prototype.verbose=function(t){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,t,null)},AuthenticationContext.prototype._libVersion=function(){return"1.0.9"};
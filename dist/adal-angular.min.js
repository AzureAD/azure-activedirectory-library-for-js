/*! adal-angular v1.0.7 2016-02-25 */
"use strict";"undefined"!=typeof module&&module.exports&&(module.exports.inject=function(a){return new AuthenticationContext(a)}),function(){if(angular){var a=angular.module("AdalAngular",[]);a.provider("adalAuthenticationService",function(){var a=null,b={isAuthenticated:!1,userName:"",loginError:"",profile:""},c=!1,d={},e=function(c){var d=a.getCachedToken(c);b.isAuthenticated=null!==d&&d.length>0;var e=a.getCachedUser()||{userName:""};b.userName=e.userName,b.profile=e.profile,b.loginError=a.getLoginError()};this.init=function(b,c){if(!b)throw new Error("You must set configOptions, when calling init");var d=window.location.hash,f=window.location.href;d&&(f=f.replace(d,"")),b.redirectUri=b.redirectUri||f,b.postLogoutRedirectUri=b.postLogoutRedirectUri||f,c&&c.interceptors&&c.interceptors.push("ProtectedResourceInterceptor"),a=new AuthenticationContext(b),e(a.config.loginResource)},this.$get=["$rootScope","$window","$q","$location","$timeout",function(f,g,h,i,j){function k(a,b){return b.requireADLogin?a.requireADLogin!==!1:!!a.requireADLogin}var l=function(){var d=g.location.hash;if(a.isCallback(d)){var h=a.getRequestInfo(d);if(a.saveTokenFromHash(h),i.$$html5?g.location=g.location.origin+g.location.pathname:g.location.hash="",h.requestType!==a.REQUEST_TYPE.LOGIN&&(a.callback=g.parent.AuthenticationContext().callback,h.requestType===a.REQUEST_TYPE.RENEW_TOKEN&&(a.callback=g.parent.callBackMappedToRenewStates[h.stateResponse])),h.stateMatch)if("function"==typeof a.callback){if(h.requestType===a.REQUEST_TYPE.RENEW_TOKEN){if(h.parameters.access_token)return void a.callback(a._getItem(a.CONSTANTS.STORAGE.ERROR_DESCRIPTION),h.parameters.access_token);if(h.parameters.id_token)return void a.callback(a._getItem(a.CONSTANTS.STORAGE.ERROR_DESCRIPTION),h.parameters.id_token)}}else e(a.config.loginResource),b.userName?(j(function(){e(a.config.loginResource),f.userInfo=b;var c=a._getItem(a.CONSTANTS.STORAGE.START_PAGE);c&&i.path(c)},1),f.$broadcast("adal:loginSuccess")):f.$broadcast("adal:loginFailure",a._getItem(a.CONSTANTS.STORAGE.ERROR_DESCRIPTION))}else e(a.config.loginResource),a._renewActive||b.isAuthenticated||!b.userName||a._getItem(a.CONSTANTS.STORAGE.FAILED_RENEW)||(c=!0,a.acquireToken(a.config.loginResource,function(d,e){d?(c=!1,f.$broadcast("adal:tokenRenewFailure","auto renew failure "+d)):(c=!1,e&&(b.isAuthenticated=!0,f.$broadcast("adal:tokenRenewSuccess",a.config.loginResource)))}));j(function(){e(a.config.loginResource),f.userInfo=b},1)},m=function(){try{return window.self!==window.top}catch(a){return console&&console.error("isInIFrame: Unexpected error:",a),!0}},n=function(){a.info("Login event for:"+i.$$path),a.config&&a.config.localLoginUrl?i.path(a.config.localLoginUrl):(a._saveItem(a.CONSTANTS.STORAGE.START_PAGE,i.$$path),a.info("Start login at:"+window.location.href),f.$broadcast("adal:loginRedirect"),a.login())},o=function(d,e){e&&e.$$route&&k(e.$$route,a.config)&&(b.isAuthenticated||m()||c||(a.info("Route change event for:"+i.$$path),n()))},p=function(d,e){e&&k(e,a.config)&&(b.isAuthenticated||m()||c||(a.info("State change event for:"+i.$$path),n()))};return f.$on("$routeChangeStart",o),f.$on("$stateChangeStart",p),f.$on("$locationChangeStart",l),e(a.config.loginResource),f.userInfo=b,{config:a.config,login:function(){a.login()},loginInProgress:function(){return a.loginInProgress()},logOut:function(){a.logOut()},getCachedToken:function(b){return a.getCachedToken(b)},userInfo:b,acquireToken:function(b){var c=h.defer();return d[b]=a.getCachedToken(b),a.acquireToken(b,function(e,g){e?(a.error("Error when acquiring token for resource: "+b,e),f.$broadcast("adal:tokenRenewFailure","auto renew failure "+e),c.reject(e)):(c.resolve(g),d[b]!==g&&(f.$broadcast("adal:tokenRenewSuccess",b),d[b]=g))}),c.promise},getUser:function(){var b=h.defer();return a.getUser(function(c,d){c?(a.error("Error when getting user",c),b.reject(c)):b.resolve(d)}),b.promise},getResourceForEndpoint:function(b){return a.getResourceForEndpoint(b)},clearCache:function(){a.clearCache()},clearCacheForResource:function(b){a.clearCacheForResource(b)},info:function(b){a.info(b)},verbose:function(b){a.verbose(b)}}}]}),a.factory("ProtectedResourceInterceptor",["adalAuthenticationService","$q","$rootScope",function(a,b,c){return{request:function(c){if(c){c.headers=c.headers||{};var d=a.getResourceForEndpoint(c.url);if(null===d)return c;var e=a.getCachedToken(d),f=!1;if(e)return a.info("Token is avaliable for this url "+c.url),c.headers.Authorization="Bearer "+e,c;if(a.config)for(var g in a.config.endpoints)c.url.indexOf(g)>-1&&(f=!0);if(a.loginInProgress())return a.info("login already start."),b.reject();if(a.config&&f){var h=b.defer();return a.acquireToken(d).then(function(b){a.verbose("Token is avaliable"),c.headers.Authorization="Bearer "+b,h.resolve(c)},function(a){h.reject(a)}),h.promise}return c}},responseError:function(d){if(a.info("Getting error in the response"),d&&401===d.status){var e=a.getResourceForEndpoint(d.config.url);a.clearCacheForResource(e),c.$broadcast("adal:notAuthorized",d,e)}return b.reject(d)}}}])}else console.error("Angular.JS is not included")}();